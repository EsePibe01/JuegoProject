[gd_scene load_steps=21 format=3 uid="uid://ddd3ked8hi5yt"]

[ext_resource type="Texture2D" uid="uid://cv735ri7s4ilo" path="res://MangoDescanso.png" id="2_6uc2p"]
[ext_resource type="Texture2D" uid="uid://bcjrgw28bnvpe" path="res://Caida1.png" id="2_cgc4o"]
[ext_resource type="Texture2D" uid="uid://13dva08hbtwq" path="res://Mango1Caminando.png" id="3_xig8c"]
[ext_resource type="Texture2D" uid="uid://dgxajlhr77mgk" path="res://Salto1.png" id="4_6uc2p"]

[sub_resource type="GDScript" id="GDScript_ygjsw"]
resource_name = "ScriptMango"
script/source = "extends CharacterBody2D

const SPEED = 300.0
const JUMP_VELOCITY = -400.0
const GRAVITY = 980.0
const FRICTION = 1500.0

const JUMP_HIGH = 0.35

# Sprite principal
var sprite: AnimatedSprite2D

var jump_timer: float = 0.0
var max_jump_time: float = JUMP_HIGH
var is_jumping: bool = false
var was_on_floor: bool = false

func _ready():
    # Asigna el sprite hijo directo llamado AnimatedSprite2D
    sprite = $AnimatedSprite2D
    sprite.speed_scale = 2.0
    sprite.animation = \"AlDescanso\"
    sprite.play()

func _physics_process(delta: float) -> void:
    # --- Movimiento horizontal ---
    var direction := Input.get_axis(\"ui_left\", \"ui_right\")
    velocity.x = direction * SPEED if direction != 0 else move_toward(velocity.x, 0, FRICTION * delta)

    # Flip horizontal sin reiniciar animación
    if direction != 0:
        sprite.flip_h = direction < 0

    # --- Salto ---
    if Input.is_action_just_pressed(\"ui_accept\") and is_on_floor():
        jump_timer = 0.0
        is_jumping = true
        max_jump_time = JUMP_HIGH

    if Input.is_action_pressed(\"ui_accept\") and is_jumping:
        jump_timer += delta
        if jump_timer <= max_jump_time:
            velocity.y = JUMP_VELOCITY
        else:
            is_jumping = false
    else:
        is_jumping = false

    # --- Gravedad ---
    if not is_on_floor():
        velocity.y += GRAVITY * delta

    # --- Animaciones ---
    var on_floor = is_on_floor()

    if not on_floor:
        if velocity.y < 0:
            if sprite.animation != \"Salto\":
                sprite.animation = \"Salto\"
                sprite.play()
        else:
            if sprite.animation != \"Caida\":
                sprite.animation = \"Caida\"
                sprite.play()
            # Frame 1 de Caida = aterrizaje
            if sprite.frame != 1 and velocity.y > 0.1:
                sprite.frame = 0
    else:
        if direction != 0:
            if sprite.animation != \"Caminar\":
                sprite.animation = \"Caminar\"
                sprite.play()
        else:
            if sprite.animation != \"AlDescanso\":
                sprite.animation = \"AlDescanso\"
                sprite.play()

    was_on_floor = on_floor

    # --- Movimiento final ---
    move_and_slide()

"

[sub_resource type="AtlasTexture" id="AtlasTexture_ow6lq"]
atlas = ExtResource("2_6uc2p")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_pp43k"]
atlas = ExtResource("2_6uc2p")
region = Rect2(0, 32, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_nsomt"]
atlas = ExtResource("2_6uc2p")
region = Rect2(0, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_6mhjg"]
atlas = ExtResource("2_6uc2p")
region = Rect2(0, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_xig8c"]
atlas = ExtResource("2_cgc4o")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_6uc2p"]
atlas = ExtResource("2_6uc2p")
region = Rect2(0, 32, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_r5quc"]
atlas = ExtResource("3_xig8c")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_gcy0b"]
atlas = ExtResource("3_xig8c")
region = Rect2(0, 32, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_urtll"]
atlas = ExtResource("3_xig8c")
region = Rect2(0, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_w0aot"]
atlas = ExtResource("3_xig8c")
region = Rect2(0, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_rggoe"]
atlas = ExtResource("4_6uc2p")
region = Rect2(0, 32, 32, 32)

[sub_resource type="SpriteFrames" id="SpriteFrames_bdie8"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_ow6lq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_pp43k")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nsomt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6mhjg")
}],
"loop": true,
"name": &"AlDescanso",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_xig8c")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6uc2p")
}],
"loop": true,
"name": &"Caida",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_r5quc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gcy0b")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_urtll")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_w0aot")
}],
"loop": true,
"name": &"Caminar",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_rggoe")
}],
"loop": true,
"name": &"Salto",
"speed": 5.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_cgc4o"]
size = Vector2(78.4, 108.869)

[sub_resource type="GDScript" id="GDScript_cgc4o"]

[sub_resource type="GDScript" id="GDScript_6uc2p"]
script/source = "extends Camera2D

@export var follow_speed: float = 5.0
var target: Node2D = null

func _ready():
	# Suponiendo que tu personaje se llama \"CharacterBody2D\" en la escena
	target = get_parent().get_node(\"CharacterBody2D\")
	make_current()  # Esto activa la cámara

func _process(delta):
	if target:
		# Movimiento suave
		global_position = lerp(global_position, target.global_position, follow_speed * delta)
"

[node name="CharacterBody2D" type="CharacterBody2D"]
script = SubResource("GDScript_ygjsw")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(115, 163.75)
scale = Vector2(2.9375, 2.60937)
sprite_frames = SubResource("SpriteFrames_bdie8")
animation = &"Salto"
frame_progress = 0.0484889

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(113.5, 167.5)
scale = Vector2(0.625, 0.597046)
shape = SubResource("RectangleShape2D_cgc4o")
script = SubResource("GDScript_cgc4o")

[node name="Camera2D" type="Camera2D" parent="."]
script = SubResource("GDScript_6uc2p")
